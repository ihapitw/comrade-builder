const fs = require('fs').promises
const glob = require('glob')
const path = require('path')
const ignore = []
const { message } = require('./message')

async function createComponentsList(sourcePath) {
  let pages = glob.sync(
    path.resolve(sourcePath, 'components/**/*.component.js')
  )

  let templateJS = `/**
 * this file is autogenerated, don't touch
 */\n\n`
  pages.sort().forEach((file) => {
    let base = path.basename(file, '.component.js')
    if (ignore.indexOf(base) === -1) {
      templateJS += `import '../components/${base}/${base}.component.js'\n`
    }
  })

  await fs.writeFile(
    path.resolve(sourcePath, 'application', 'components.js'),
    templateJS
  )

  message('Autogenerated imports succesful created!')
}

module.exports = createComponentsList
